<!DOCTYPE html>
<html>
<head>
    <meta charset=UTF-8>
    <title>Tomcat WebSocket Chat</title>
    <script>
        function getParameterByName(name) {
            name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
            var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                    results = regex.exec(location.search);
            return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
        }
        var file;
        var type;
        function init() {
            file = getParameterByName('fileName');
            type = getParameterByName('type');
            alert(file);
            postToServer();
        }

        var ws = new WebSocket("ws://localhost:8080/websocket");
        ws.onopen = function () {
        };
        ws.onmessage = function (message) {
            document.getElementById("chatlog").textContent += message.data + "\n";
        };
        function postToServer() {
            ws.send(file + '_' + type);
        }
        function closeConnect() {
            ws.close();
        }
        window.onbeforeunload = function () {
            closeConnect();
        };

    </script>
</head>
<body onload="init()">
<textarea id="chatlog" readonly></textarea><br/>
<input id="msg" type="text"/>
<!--<button type="submit" id="sendButton" onClick="postToServer()">Send!</button>-->
<button type="submit" id="sendButton" onClick="closeConnect()">End</button>
</body>
</html>
