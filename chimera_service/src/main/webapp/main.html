<html>
	<head>
        <meta charset="UTF-8">
		<title>Chimera Visualization Service</title>
        <link rel="stylesheet" type="text/css" href="css/styles/pages/main/style.css" />
        <link rel="stylesheet" type="text/css" href="css/styles/controls/buttons/style.css" />
        <link rel="stylesheet" type="text/css" href="css/styles/controls/textboxes/style.css" />
        <link rel="stylesheet" type="text/css" href="css/styles/controls/labels/style.css" />
        <link rel="stylesheet" type="text/css" href="css/styles/controls/progress/style.css" />
        <script type="text/javascript" src="js/ChimeraVisualizationManager.js"></script>
        <script type="text/javascript" src="js/ThirdParty/three.js"></script>
        <script type="text/javascript" src="js/API/ColorConverter.js"></script>
        <script type="text/javascript" src="js/API/Globals.js"></script>
        <script type="text/javascript" src="js/API/Options.js"></script>
        <script type="text/javascript" src="js/API/NameList.js"></script>
        <script type="text/javascript" src="js/API/RGB.js"></script>
        <script type="text/javascript" src="js/API/Messaging.js"></script>
        <script type="text/javascript" src="js/ComponentsLoader/PageGrid.js"></script>
        <script type="text/javascript" src="js/ComponentsLoader/PositionReader.js"></script>
        <script type="text/javascript" src="js/ComponentsLoader/positionConfig.js"></script>
        <script type="text/javascript" src="js/ComponentsLoader/UIManager.js"></script>
        <script type="text/javascript" src="js/ComponentsLoader/UICreator.js"></script>
        <script type="text/javascript" src="js/BuildModelProcessor/BuildProcessor.js"></script>
        <script type="text/javascript" src="js/BuildModelProcessor/Strategies/PhaseVisualizationStrategy.js"></script>
        <script type="text/javascript" src="js/BuildModelProcessor/Strategies/FrequencyVisualizationStrategy.js"></script>
        <script type="text/javascript" src="js/DataProcessor/SocketDataInspector.js"></script>
        <script type="text/javascript" src="js/DataProcessor/DataDecryptedService/DataDecryptedService.js"></script>
        <script type="text/javascript" src="js/VideoProcessor/VideoProcessor.js"></script>
        <script type="text/javascript" src="js/CutProcessor/CutProcessor.js"></script>
	</head>
	<body onKeyDown="keyEvent(event)">
        <div id="container" class="container"></div>
        <script type="text/javascript">
            var chimeraData = [];
            var pageGrid;
            var visualizationType;
            var oscilatorsCount;
            var buildProcessor;
            var cutProcessor;
            var videoProcessor;
            var uiManager;
            var chimeraManager = new ChimeraVisualizationManager();
            
            function init()
            {
                var inspector = new SocketDataInspector();
                uiManager = new UIManager();

                inspector.init(DataReadyCallback, uiManager.loadLoadingScene);

                visualizationType = inspector.getType(Globals.VisualizationType);
                oscilatorsCount = inspector.getOscillatorNumber(Globals.FilePath);

                Globals.OscillatorsNumber = oscilatorsCount;

                switch (oscilatorsCount) {
                    case Globals.MediumOsillatorsCount:
                        Options.DefaultCameraPosition = Globals.CameraPositionMedium;
                        break;
                    case Globals.LargeOsillatorsCount:
                        Options.DefaultCameraPosition = Globals.CameraPositionLarge;
                        break;
                    default:
                        break;
                }

                buildProcessor = new BuildProcessor(visualizationType);
            }

            function DataReadyCallback()
            {
                var dataDecryptService = new DataDecryptedService();
                var container = document.getElementById("sockerDataTransferContainer");

                chimeraData = container.innerHTML;
                chimeraData = dataDecryptService.decryptData(chimeraData);
                
                uiManager.closeLoadingScene();
                uiManager.loadOneFrameVisualizationScene();
            }

            window.onload = function onload() {
                init();

                pageGrid = new PageGrid();

                pageGrid.CreateGrid(window.innerWidth, window.innerHeight);
                uiManager.calculatePositions(pageGrid);
            };
            
            window.onoffline = function () {
                Messaging.ShowMessage(Messaging.Warning, Messaging.OnOfflineWarning);
            }

            function keyEvent(event) {
                switch (event.keyCode) {
                    case 37:
                        buildProcessor.rotate_left();
                        break;
                    case 38:
                        buildProcessor.rotate_up();
                        break;
                    case 39:
                        buildProcessor.rotate_right();
                        break;
                    case 40:
                        buildProcessor.rotate_down();
                        break;
                    case 107:
                        buildProcessor.zoom();
                        break;
                    case 109:
                        buildProcessor.unzoom();
                        break;
                    case 27:
                        if (cutProcessor != null) {
                            uiManager.getUICreator().setControlValue(NameList.CurrentCutType, 'Current Cut type: none');
                            cutProcessor.exit();
                        }
                        break;
                    default:
                        break;
                }

            }

        </script>
        
        <progress id="loadingProgressBar" class="chimeraProgressBar" max="100" value="0"></progress>
        <input id="loadingLabel" type="text" class="chimeraProgressLabel" value="Loading...Please wait..." />
        <input id="textLabel" type="text" class="chimeraLabel" value="Time moment:" disabled />
        <input id="time" type="text" style="position:absolute; visibility:hidden" class="chimeraTextBox" value="1" />
        <input id="build" type="button" class="chimeraButton" value="Build" onclick="chimeraManager.startVisualization()">
        <input id="video3D" type="button" class="chimeraButton" value="Video 3D" onclick="chimeraManager.playVideo()">
        <input id="videoPause" type="button" class="chimeraButton" value="Pause" onclick="chimeraManager.videoPause()">
        <input id="videoNext" type="button" class="chimeraButton" value="Next" onclick="chimeraManager.videoNext()" disabled>
        <input id="videoBack" type="button" class="chimeraButton" value="Back" onclick="chimeraManager.videoBack()" disabled>
        <input id="videoClose" type="button"class="chimeraButton" value="Close" onclick="chimeraManager.videoClose()">
        <input id="currentFrame" type="text" class="chimeraLabel" value="Current Frame:" disabled />
        <input id="cut" type="submit" class="chimeraButton" value="Cut" onclick="chimeraManager.cut()">
        <input id="horizontalCut" type="button" class="chimeraButton" value="H" onclick="chimeraManager.horizontalCut()"/>
        <input id="verticalCut" type="button" class="chimeraButton" value="V" onclick="chimeraManager.verticalCut()"/>
        <input id="currentCutType" type="text" class="chimeraLabel" value="Current Cut type: none" disabled />
        <input id="closeCut" type="button" class="chimeraButton" value="Exit from the Cut mode" onclick="chimeraManager.closeCut()" />
        <input id="opacity" type="range" style="position:absolute; visibility:hidden" min="0" step="0.01" max="1" value="0.12" onchange="chimeraManager.onOpacityChanged()">
        <input id="opacityLabel" type="text" class="chimeraLabel" value="Opacity" disabled />
        <input id="pointSize" type="range" style="position:absolute; visibility:hidden" min="0.5" step="0.1" max="10" value="3.5" onchange="chimeraManager.onPointSizeChanged()">
        <input id="pointSizeLabel" type="text" class="chimeraLabel" value="Particle Size" disabled />
        <label id="sockerDataTransferContainer" style="display:none"></label>

    </body>
</html>